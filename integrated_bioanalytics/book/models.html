<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>models | Integrated Bioanalytics</title>
<meta name="author" content="Lucas Busta and members of the Busta lab">
<meta name="description" content="univariate Next on our quest to develop our abilities in analytical data exploration is modeling. We will start with some of the simplest models - linear models. There are a variety of ways to...">
<meta name="generator" content="bookdown 0.35 with bs4_book()">
<meta property="og:title" content="models | Integrated Bioanalytics">
<meta property="og:type" content="book">
<meta property="og:description" content="univariate Next on our quest to develop our abilities in analytical data exploration is modeling. We will start with some of the simplest models - linear models. There are a variety of ways to...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="models | Integrated Bioanalytics">
<meta name="twitter:description" content="univariate Next on our quest to develop our abilities in analytical data exploration is modeling. We will start with some of the simplest models - linear models. There are a variety of ways to...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Lato-0.4.6/font.css" rel="stylesheet">
<link href="libs/Roboto_Mono-0.4.6/font.css" rel="stylesheet">
<link href="libs/Montserrat-0.4.6/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-99618359-1', 'auto');
      ga('send', 'pageview');

    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h2>
        <a href="index.html" title="">Integrated Bioanalytics</a>
      </h2>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">WELCOME</a></li>
<li class="book-part">DATA ANALYSIS IN R</li>
<li><a class="" href="overview.html">overview</a></li>
<li><a class="" href="installation.html">installation</a></li>
<li><a class="" href="data-visualization-i.html">data visualization I</a></li>
<li><a class="" href="data-visualization-ii.html">data visualization II</a></li>
<li><a class="" href="data-visualization-iii.html">data visualization III</a></li>
<li><a class="" href="data-wrangling-and-summaries.html">data wrangling and summaries</a></li>
<li><a class="" href="dimensionality-reduction.html">dimensionality reduction</a></li>
<li><a class="" href="clustering.html">clustering</a></li>
<li><a class="active" href="models.html">models</a></li>
<li><a class="" href="comparing-means.html">comparing means</a></li>
<li><a class="" href="special-topics.html">special topics</a></li>
<li class="book-part">GC-MS DATA</li>
<li><a class="" href="mass-spectrometric-analysis.html">mass spectrometric analysis</a></li>
<li class="book-part">TRANSCRIPTOME ANALYSIS</li>
<li><a class="" href="transcriptome-assembly.html">transcriptome assembly</a></li>
<li class="book-part">EVOLUTIONARY ANALYSIS</li>
<li><a class="" href="similarity-searching.html">similarity searching</a></li>
<li><a class="" href="alignments.html">alignments</a></li>
<li><a class="" href="phylogenies.html">phylogenies</a></li>
<li><a class="" href="phylogenetic-analyses.html">phylogenetic analyses</a></li>
<li><a class="" href="comparative-genomics.html">comparative genomics</a></li>
<li class="book-part">LANGUAGE MODELS</li>
<li><a class="" href="completiongpt.html">completionGPT</a></li>
<li><a class="" href="analyzeliterature.html">analyzeLiterature</a></li>
<li class="book-part">SCIENTIFIC WRITING</li>
<li><a class="" href="overview-1.html">overview</a></li>
<li><a class="" href="figures-captions.html">figures &amp; captions</a></li>
<li><a class="" href="results-and-discussion.html">results and discussion</a></li>
<li><a class="" href="conclusion-and-introduction.html">conclusion and introduction</a></li>
<li><a class="" href="abstract-and-title.html">abstract and title</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="links.html">links</a></li>
<li><a class="" href="r-faq.html">r faq</a></li>
<li><a class="" href="templates.html">templates</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/thebustalab/thebustalab.github.io/tree/master/integrated_bioanalytics">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="models" class="section level1 unnumbered">
<h1>models<a class="anchor" aria-label="anchor" href="#models"><i class="fas fa-link"></i></a>
</h1>
<div id="univariate" class="section level2 unnumbered">
<h2>univariate<a class="anchor" aria-label="anchor" href="#univariate"><i class="fas fa-link"></i></a>
</h2>
<p>Next on our quest to develop our abilities in analytical data exploration is modeling. We will start with some of the simplest models - linear models. There are a variety of ways to build linear models in R, but we will use a function called <code>buildLinearModel</code>. To use it, we simply give it our data, and tell it which to sets of values we want to compare. To tell it what we want to compare, we give it a formula in the form of Y = M x X + B, however, the B term and the M are implicit, so all we need to tell it is Y = X.</p>
<p>Let’s look at an example. Suppose we want to know if the abundances of ADP and AMP are related in our metabolomics dataset:</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">metabolomics_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">AMP</span>, y <span class="op">=</span> <span class="va">ADP</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="index_files/figure-html/unnamed-chunk-137-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>It looks like there might be a relationship! Let’s build a linear model for that relationship:</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu">buildLinearModel</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">metabolomics_data</span>,</span>
<span>  formula <span class="op">=</span> <span class="st">"ADP = AMP"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">model</span>, strict.width <span class="op">=</span> <span class="st">"cut"</span><span class="op">)</span></span>
<span><span class="co">## List of 2</span></span>
<span><span class="co">##  $ metrics:'data.frame': 6 obs. of  5 variables:</span></span>
<span><span class="co">##   ..$ variable: chr [1:6] "(Intercept)" "AMP" "median_res"..</span></span>
<span><span class="co">##   ..$ value   : num [1:6] 0.7842 0.9142 0.0415 40.3224 15...</span></span>
<span><span class="co">##   ..$ std_err : chr [1:6] "1.0056" "0.0757" NA NA ...</span></span>
<span><span class="co">##   ..$ type    : chr [1:6] "coefficient" "coefficient" "st"..</span></span>
<span><span class="co">##   ..$ p_value : chr [1:6] "0.43750684" "0" NA NA ...</span></span>
<span><span class="co">##  $ data   :'data.frame': 92 obs. of  7 variables:</span></span>
<span><span class="co">##   ..$ input_x  : num [1:92] 13.2 13.5 14.3 13.3 12 ...</span></span>
<span><span class="co">##   ..$ input_y  : num [1:92] 12.8 13.1 13.3 13.2 11.9 ...</span></span>
<span><span class="co">##   ..$ ADP      : num [1:92] 12.8 13.1 13.3 13.2 11.9 ...</span></span>
<span><span class="co">##   ..$ AMP      : num [1:92] 13.2 13.5 14.3 13.3 12 ...</span></span>
<span><span class="co">##   ..$ residuals: num [1:92] 0.0312 -0.0217 -0.6014 0.2458 ..</span></span>
<span><span class="co">##   ..$ model_y  : num [1:92] 12.8 13.1 13.9 13 11.8 ...</span></span>
<span><span class="co">##   ..$ model_x  : num [1:92] 13.2 13.5 14.3 13.3 12 ...</span></span></code></pre></div>
<p>The model consists of two thigs: metrics and data. Let’s look at the metrics:</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="va">metrics</span></span>
<span><span class="co">##               variable   value std_err        type</span></span>
<span><span class="co">## 1          (Intercept)  0.7842  1.0056 coefficient</span></span>
<span><span class="co">## 2                  AMP  0.9142  0.0757 coefficient</span></span>
<span><span class="co">## 3      median_residual  0.0415    &lt;NA&gt;   statistic</span></span>
<span><span class="co">## 4    total_sum_squares 40.3224    &lt;NA&gt;   statistic</span></span>
<span><span class="co">## 5 residual_sum_squares 15.3901    &lt;NA&gt;   statistic</span></span>
<span><span class="co">## 6            r_squared  0.6183    &lt;NA&gt;   statistic</span></span>
<span><span class="co">##      p_value</span></span>
<span><span class="co">## 1 0.43750684</span></span>
<span><span class="co">## 2          0</span></span>
<span><span class="co">## 3       &lt;NA&gt;</span></span>
<span><span class="co">## 4       &lt;NA&gt;</span></span>
<span><span class="co">## 5       &lt;NA&gt;</span></span>
<span><span class="co">## 6       &lt;NA&gt;</span></span></code></pre></div>
<p>It shows us the intercept (b), the variable for AMP (i.e. the slope, m), as well some other things (we will talk about them in a second). The other thing the model contains is the data (below). This includes the input_x and y values. The raw values for ADP and AMP, the residuals (see below for details), and the x and y values generated by the model.</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">##    input_x  input_y      ADP      AMP   residuals  model_y</span></span>
<span><span class="co">## 1 13.15029 12.83791 12.83791 13.15029  0.03119000 12.80672</span></span>
<span><span class="co">## 2 13.48362 13.08980 13.08980 13.48362 -0.02165141 13.11146</span></span>
<span><span class="co">## 3 14.32515 13.27943 13.27943 14.32515 -0.60138528 13.88082</span></span>
<span><span class="co">## 4 13.31191 13.20029 13.20029 13.31191  0.24581244 12.95448</span></span>
<span><span class="co">## 5 11.99764 11.93350 11.93350 11.99764  0.18057517 11.75293</span></span>
<span><span class="co">## 6 12.95966 12.83649 12.83649 12.95966  0.20405638 12.63243</span></span>
<span><span class="co">##    model_x</span></span>
<span><span class="co">## 1 13.15029</span></span>
<span><span class="co">## 2 13.48362</span></span>
<span><span class="co">## 3 14.32515</span></span>
<span><span class="co">## 4 13.31191</span></span>
<span><span class="co">## 5 11.99764</span></span>
<span><span class="co">## 6 12.95966</span></span></code></pre></div>
<p>Let’s plot the model!</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input_x</span>, y <span class="op">=</span> <span class="va">input_y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">model_x</span>, y <span class="op">=</span> <span class="va">model_y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="index_files/figure-html/unnamed-chunk-141-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>Very good. Now let’s talk about evaluating the quality of our model. For this we need some means of assessing how well our line fits our data. We will use residuals - the distance between each of our points and our line.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input_x</span>, y <span class="op">=</span> <span class="va">input_y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">model_x</span>, y <span class="op">=</span> <span class="va">model_y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input_x</span>, y <span class="op">=</span> <span class="va">input_y</span>, xend <span class="op">=</span> <span class="va">input_x</span>, yend <span class="op">=</span> <span class="va">model_y</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="index_files/figure-html/unnamed-chunk-142-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>We can calculate the sum of the squared residuals:</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span></span>
<span>  <span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">input_y</span> <span class="op">-</span> <span class="va">model</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">model_y</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## [1] 15.39014</span></span></code></pre></div>
<p>15.39! Let’s call that the “residual sum of the squares”. So. 15.39.. does that mean our model is good? I don’t know. We have to compare that number to something. Let’s compare it to a super simple model that is just defined by the mean y value of the input data.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">metabolomics_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">AMP</span>, y <span class="op">=</span> <span class="va">ADP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ADP</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="index_files/figure-html/unnamed-chunk-144-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>A pretty bad model, I agree. How much better is our linear model that the flat line model? Let’s create a measure of the distance between each point and the point predicted for that same x value on the model:</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span></span>
<span>  <span class="op">(</span><span class="va">metabolomics_data</span><span class="op">$</span><span class="va">ADP</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">metabolomics_data</span><span class="op">$</span><span class="va">ADP</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span>
<span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">## [1] 40.32239</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">metabolomics_data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">AMP</span>, y <span class="op">=</span> <span class="va">ADP</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_hline</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ADP</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">AMP</span>, y <span class="op">=</span> <span class="va">ADP</span>, xend <span class="op">=</span> <span class="va">AMP</span>, yend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">ADP</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="index_files/figure-html/unnamed-chunk-145-1.png" width="100%" style="display: block; margin: auto;"></div>
<p>40.32! Wow. Let’s call that the “total sum of the squares”, and now we can compare that to our “residual sum of the squares”:</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">15.39</span><span class="op">/</span><span class="fl">40.32</span><span class="op">)</span></span>
<span><span class="co">## [1] 0.6183036</span></span></code></pre></div>
<p>0.68! Alright. That is our R squared value. It is equal to 1 minus the ratio of the “residual sum of the squares” to the “total sum of the squares”. Now, let’s put it all together and make it pretty:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">top</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input_x</span>, y <span class="op">=</span> <span class="va">input_y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">model_x</span>, y <span class="op">=</span> <span class="va">model_y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"table"</span>,</span>
<span>    x <span class="op">=</span> <span class="fl">11.4</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">16</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">metrics</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_cartesian</span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">16</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bottom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">data</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">input_x</span>, y <span class="op">=</span> <span class="va">residuals</span><span class="op">)</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">0.03</span>, color <span class="op">=</span> <span class="st">"black"</span>, position <span class="op">=</span> <span class="st">"dodge"</span>, alpha <span class="op">=</span> <span class="fl">0.5</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html">plot_grid</a></span><span class="op">(</span><span class="va">top</span>, <span class="va">bottom</span>, ncol <span class="op">=</span> <span class="fl">1</span>, labels <span class="op">=</span> <span class="st">"AUTO"</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="index_files/figure-html/unnamed-chunk-147-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="multivariate" class="section level2 unnumbered">
<h2>multivariate<a class="anchor" aria-label="anchor" href="#multivariate"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">model1</span> <span class="op">&lt;-</span> <span class="fu">buildLinearModel</span><span class="op">(</span><span class="va">metabolomics_data</span>, formula <span class="op">=</span> <span class="st">"ADP = AMP"</span><span class="op">)</span></span>
<span><span class="va">model1</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">## $metrics</span></span>
<span><span class="co">##               variable   value std_err        type</span></span>
<span><span class="co">## 1          (Intercept)  0.7842  1.0056 coefficient</span></span>
<span><span class="co">## 2                  AMP  0.9142  0.0757 coefficient</span></span>
<span><span class="co">## 3      median_residual  0.0415    &lt;NA&gt;   statistic</span></span>
<span><span class="co">## 4    total_sum_squares 40.3224    &lt;NA&gt;   statistic</span></span>
<span><span class="co">## 5 residual_sum_squares 15.3901    &lt;NA&gt;   statistic</span></span>
<span><span class="co">## 6            r_squared  0.6183    &lt;NA&gt;   statistic</span></span>
<span><span class="co">##      p_value</span></span>
<span><span class="co">## 1 0.43750684</span></span>
<span><span class="co">## 2          0</span></span>
<span><span class="co">## 3       &lt;NA&gt;</span></span>
<span><span class="co">## 4       &lt;NA&gt;</span></span>
<span><span class="co">## 5       &lt;NA&gt;</span></span>
<span><span class="co">## 6       &lt;NA&gt;</span></span>
<span><span class="va">model2</span> <span class="op">&lt;-</span> <span class="fu">buildLinearModel</span><span class="op">(</span><span class="va">metabolomics_data</span>, formula <span class="op">=</span> <span class="st">"ADP = AMP + IMP"</span><span class="op">)</span></span>
<span><span class="va">model2</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">## $metrics</span></span>
<span><span class="co">##               variable   value std_err        type</span></span>
<span><span class="co">## 1          (Intercept)  2.0057  0.9222 coefficient</span></span>
<span><span class="co">## 2                  AMP  0.6201  0.0907 coefficient</span></span>
<span><span class="co">## 3                  IMP  0.2303  0.0606 coefficient</span></span>
<span><span class="co">## 4      median_residual  0.0462    &lt;NA&gt;   statistic</span></span>
<span><span class="co">## 5    total_sum_squares 40.3224    &lt;NA&gt;   statistic</span></span>
<span><span class="co">## 6 residual_sum_squares 11.6145    &lt;NA&gt;   statistic</span></span>
<span><span class="co">## 7            r_squared  0.6494    &lt;NA&gt;   statistic</span></span>
<span><span class="co">##      p_value</span></span>
<span><span class="co">## 1 0.03232768</span></span>
<span><span class="co">## 2          0</span></span>
<span><span class="co">## 3 0.00026437</span></span>
<span><span class="co">## 4       &lt;NA&gt;</span></span>
<span><span class="co">## 5       &lt;NA&gt;</span></span>
<span><span class="co">## 6       &lt;NA&gt;</span></span>
<span><span class="co">## 7       &lt;NA&gt;</span></span>
<span></span>
<span><span class="va">plot1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">metabolomics_data</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="va">AMP</span><span class="op">*</span><span class="fl">0.9142</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.7842</span>, y <span class="op">=</span> <span class="va">ADP</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"gold"</span>, shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">10</span>, xend <span class="op">=</span> <span class="fl">15</span>, yend <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"table"</span>,</span>
<span>    x <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">15</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">model1</span><span class="op">$</span><span class="va">metrics</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">metabolomics_data</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">(</span><span class="va">AMP</span><span class="op">*</span><span class="fl">0.6201</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">IMP</span><span class="op">*</span><span class="fl">0.2303</span><span class="op">)</span> <span class="op">+</span> <span class="fl">2.0057</span>, y <span class="op">=</span> <span class="va">ADP</span><span class="op">)</span>, </span>
<span>    fill <span class="op">=</span> <span class="st">"maroon"</span>, shape <span class="op">=</span> <span class="fl">21</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">annotate</span><span class="op">(</span></span>
<span>    geom <span class="op">=</span> <span class="st">"table"</span>,</span>
<span>    x <span class="op">=</span> <span class="fl">10</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">15</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">model2</span><span class="op">$</span><span class="va">metrics</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_segment</span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">10</span>, y <span class="op">=</span> <span class="fl">10</span>, xend <span class="op">=</span> <span class="fl">15</span>, yend <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"black"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot1</span><span class="op">/</span><span class="va">plot2</span></span></code></pre></div>
<div class="inline-figure"><img src="index_files/figure-html/unnamed-chunk-148-1.png" width="100%" style="display: block; margin: auto;"></div>
</div>
<div id="classification" class="section level2 unnumbered">
<h2>classification<a class="anchor" aria-label="anchor" href="#classification"><i class="fas fa-link"></i></a>
</h2>
<p>We will use random forests, a type of machine learning model, to make classification models. Start by watching these videos:
1. Decision trees: <a href="https://www.youtube.com/watch?v=_L39rN6gz7Y" class="uri">https://www.youtube.com/watch?v=_L39rN6gz7Y</a>
2. Random forests: <a href="https://www.youtube.com/watch?v=J4Wdy0Wc_xQ" class="uri">https://www.youtube.com/watch?v=J4Wdy0Wc_xQ</a></p>
<p>Now we will make a classification model using random forests. The overall idea is to make a workflow, which consists of a recipe (the data) and a model (random forest and associated parameters), then tune the model and add the best parameters to the workflow, and finally evaluate the model with the test data. That model can then be used on further data for classification. Here is the general idea in schematic form:</p>
<p><code>workflow %&gt;% add_recipe() %&gt;% add_model() -&gt; workflow</code>
<code>workflow %&gt;% tune_grid() %&gt;% select_best() -&gt; best_parameters</code>
<code>workflow %&gt;% finalize_workflow() %&gt;% last_fit()</code></p>
<p>Start by making a number of forests that is the square of the number of variables and then try a few values above and below that number.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Randomly split data into a traing set and a testing set</span></span>
<span>    <span class="va">metabolomics_data_split</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span><span class="va">metabolomics_data</span>, prop <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Create a workflow that has a recipe and a model</span></span>
<span>  <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">add_recipe</span><span class="op">(</span></span>
<span>      <span class="fu">recipe</span><span class="op">(</span> <span class="va">patient_status</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">metabolomics_data</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu">step_normalize</span><span class="op">(</span><span class="fu">all_numeric</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">step_impute_knn</span><span class="op">(</span><span class="fu">all_predictors</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">add_model</span><span class="op">(</span></span>
<span>      <span class="fu">rand_forest</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># specify that the model is a random forest</span></span>
<span>      <span class="fu">set_args</span><span class="op">(</span>mtry <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span>, trees <span class="op">=</span> <span class="fu">tune</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># specify that the `mtry` and `trees` parameters needs to be tuned</span></span>
<span>      <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span>, importance <span class="op">=</span> <span class="st">"impurity"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># select the engine/package that underlies the model</span></span>
<span>      <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="co"># choose either the continuous regression or binary classification mode</span></span>
<span>    <span class="op">)</span> <span class="op">-&gt;</span> <span class="va">workflow</span></span>
<span></span>
<span><span class="co">## Tune the model on the training set</span></span>
<span>  <span class="va">tune_results</span> <span class="op">&lt;-</span> <span class="fu">tune_grid</span><span class="op">(</span></span>
<span>    <span class="va">workflow</span>,</span>
<span>    resamples <span class="op">=</span> <span class="fu">vfold_cv</span><span class="op">(</span><span class="fu">training</span><span class="op">(</span><span class="va">metabolomics_data_split</span><span class="op">)</span><span class="op">)</span>, <span class="co">#CV object</span></span>
<span>    grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>mtry <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span><span class="op">)</span>, trees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">800</span>,<span class="fl">50</span><span class="op">)</span><span class="op">)</span>, <span class="co"># grid of values to try</span></span>
<span>    metrics <span class="op">=</span> <span class="fu">metric_set</span><span class="op">(</span><span class="va">accuracy</span>, <span class="va">roc_auc</span><span class="op">)</span> <span class="co"># metrics we care about</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># Check model parameters if you want</span></span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="va">tune_results</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.metric</span> <span class="op">==</span> <span class="st">"accuracy"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">mtry</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">trees</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">mean</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_tile</span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_fill_viridis</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_y_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size <span class="op">=</span> <span class="fl">18</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="index_files/figure-html/unnamed-chunk-149-1.png" width="100%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="fu">select_best</span><span class="op">(</span><span class="va">tune_results</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span><span class="op">)</span></span>
<span><span class="co">## # A tibble: 1 × 3</span></span>
<span><span class="co">##    mtry trees .config               </span></span>
<span><span class="co">##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                 </span></span>
<span><span class="co">## 1     7   100 Preprocessor1_Model014</span></span>
<span></span>
<span><span class="co">## Apply the best parameters to the workflow and evaluate performance on test data</span></span>
<span>  <span class="va">workflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu">finalize_workflow</span><span class="op">(</span> <span class="fu">select_best</span><span class="op">(</span><span class="va">tune_results</span>, metric <span class="op">=</span> <span class="st">"accuracy"</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co"># Select best parameters</span></span>
<span>    <span class="fu">last_fit</span><span class="op">(</span><span class="va">metabolomics_data_split</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">wf_fit</span> <span class="co"># Fit the test data</span></span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="va">wf_fit</span><span class="op">)</span> <span class="co"># Check on the metrics if you want</span></span>
<span><span class="co">## # A tibble: 2 × 4</span></span>
<span><span class="co">##   .metric  .estimator .estimate .config             </span></span>
<span><span class="co">##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span><span class="co">## 1 accuracy binary         0.875 Preprocessor1_Model1</span></span>
<span><span class="co">## 2 roc_auc  binary         0.958 Preprocessor1_Model1</span></span>
<span>  <span class="va">test_predictions</span> <span class="op">&lt;-</span> <span class="fu">collect_predictions</span><span class="op">(</span><span class="va">wf_fit</span><span class="op">)</span> <span class="co"># Collect predictions</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">test_predictions</span><span class="op">$</span><span class="va">.pred_class</span> <span class="op">==</span> <span class="va">test_predictions</span><span class="op">$</span><span class="va">patient_status</span><span class="op">)</span> <span class="co"># number right and wrong</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## FALSE  TRUE </span></span>
<span><span class="co">##     3    21</span></span>
<span>  <span class="fu">conf_mat</span><span class="op">(</span><span class="va">test_predictions</span>, truth <span class="op">=</span> <span class="va">patient_status</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span> <span class="co"># confusion matrix</span></span>
<span><span class="co">##                 Truth</span></span>
<span><span class="co">## Prediction       healthy kidney_disease</span></span>
<span><span class="co">##   healthy             10              1</span></span>
<span><span class="co">##   kidney_disease       2             11</span></span></code></pre></div>
</div>
<div id="exercises-6" class="section level2 unnumbered">
<h2>exercises<a class="anchor" aria-label="anchor" href="#exercises-6"><i class="fas fa-link"></i></a>
</h2>
<p>To practice creating linear models, try the following:</p>
<ol style="list-style-type: decimal">
<li><p>Choose one of the datasets we have used so far, and run a principal components analysis on it. Note that the output of the analysis when you run “pca_ord” contains the Dimension 1 coordinate “Dim.1” for each sample, as well as the abundance of each analyte in that sample.</p></li>
<li><p>Using the information from the ordination plot, identify two analytes: one that has a variance that is strongly and positively correlated with the first principal component (i.e. dimension 1), and one that has a variance that is slightly less strongly, but still positively correlated with the first principal component. Using <code>buildLinearModel</code>, create and plot two linear models, one that regresses each of those analytes against dimension 1. Which has the greater r-squared value? Based on what you know about PCA, does that make sense?</p></li>
<li><p>Choose two analytes: one should be one of the analytes from question 2 above, the other should be an analyte that, according to your PCA ordination analysis, is negatively correlated with the first principal component. Using <code>buildLinearModel</code> create plots showing how those two analytes are correlated with dimension 1. One should be positively correlated, and the other negatively correlated. Enhance the plots by including in them a visual represetation of the residuals.</p></li>
</ol>
</div>
<div id="further-reading-7" class="section level2 unnumbered">
<h2>further reading<a class="anchor" aria-label="anchor" href="#further-reading-7"><i class="fas fa-link"></i></a>
</h2>
<p><a href="https://github.com/easystats/performance" class="uri">https://github.com/easystats/performance</a></p>
<p>Here is more information on common machine learning tasks:
<a href="https://pythonprogramminglanguage.com/machine-learning-tasks/" class="uri">https://pythonprogramminglanguage.com/machine-learning-tasks/</a></p>
<p>Some major tasks include:
Classification
Regression
Clustering</p>
<p>Classification with random forests:
1. <a href="http://www.rebeccabarter.com/blog/2020-03-25_machine_learning/" class="uri">http://www.rebeccabarter.com/blog/2020-03-25_machine_learning/</a>
2. <a href="https://hansjoerg.me/2020/02/09/tidymodels-for-machine-learning/" class="uri">https://hansjoerg.me/2020/02/09/tidymodels-for-machine-learning/</a>
3. <a href="https://towardsdatascience.com/dials-tune-and-parsnip-tidymodels-way-to-create-and-tune-model-parameters-c97ba31d6173" class="uri">https://towardsdatascience.com/dials-tune-and-parsnip-tidymodels-way-to-create-and-tune-model-parameters-c97ba31d6173</a></p>
<!-- end -->
<!-- start comparing means -->
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="clustering.html">clustering</a></div>
<div class="next"><a href="comparing-means.html">comparing means</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <h2>Note: Second Edition is under construction 🏗</h2>
    <p>Now is a great time to provide feedback</p>
        <ul class="list-unstyled">
<li><a href="https://forms.gle/SZmB2Ct2exE2dBwv9">Provide feedback (5 min)</a></li>
          <!-- <li><a href="https://geocompr.robinlovelace.net/#reproducibility">Install updated packages</a></li> -->
          <!-- <li><a href="https://github.com/Robinlovelace/geocompr/issues">Open an issue <i class="fas fa-question"></i></a></li> -->
          <!-- <li><a href="https://discord.gg/Te3gWeDwmf">Chat on Discord <i class="fab fa-discord"></i></a></li> -->
        </ul>
<hr>
<nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#models">models</a></li>
<li><a class="nav-link" href="#univariate">univariate</a></li>
<li><a class="nav-link" href="#multivariate">multivariate</a></li>
<li><a class="nav-link" href="#classification">classification</a></li>
<li><a class="nav-link" href="#exercises-6">exercises</a></li>
<li><a class="nav-link" href="#further-reading-7">further reading</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/thebustalab/thebustalab.github.io/tree/master/integrated_bioanalytics/blob/main/index.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/thebustalab/thebustalab.github.io/tree/master/integrated_bioanalytics/edit/main/index.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Integrated Bioanalytics</strong>" was written by Lucas Busta and members of the Busta lab. It was last built on 2023-09-06.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
